{"ast":null,"code":"var _jsxFileName = \"/Users/peterchen/Dropbox/Hexlink/Projects/pwa-demo/src/layouts/landing.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState } from \"react\";\nimport { Container, SignInButton, Copy, UserName } from \"components/shared\";\nimport getPasskeyCredential from \"utils/passkey/authenticate/getPasskeyCredential\";\nimport verifyUserId from \"utils/passkey/authenticate/verifyUserId\";\nimport verifyClientData from \"utils/passkey/authenticate/verifyClientData\";\nimport { useSelector } from \"react-redux\";\nimport * as base64url from \"../utils/passkey/shared/base64url-arraybuffer\";\nimport { authResponseToSigVerificationInput } from \"utils/passkey/shared/authResponseToSigVerificationInput\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n// markup\nconst Landing = ({\n  onRegister,\n  onSignIn\n}) => {\n  _s();\n  const [username, setUsername] = useState(\"\");\n  const userAccounts = useSelector(state => state.userAccounts.accounts);\n  const onUserNameChanged = ev => {\n    setUsername(ev.target.value);\n  };\n\n  // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n  // MARK: THIS SHOULD BE DONE ON THE BACKEND\n  // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n  /*\n      This functionality gathers the user account requested,\n      this should be gathered via an API call to the backend.\n  */\n\n  const getUserAccount = () => {\n    if (userAccounts === undefined) {\n      return null;\n    }\n    const match = userAccounts.filter(item => item.username.toLowerCase() === username.toLowerCase());\n    if (match.length > 0) {\n      return match[0];\n    } else {\n      return null;\n    }\n  };\n  const performLogin = async (challenge, username) => {\n    console.log(\"⚈ ⚈ ⚈ performLogin ⚈ ⚈ ⚈\");\n    try {\n      const credential = await getPasskeyCredential(challenge, username);\n      console.log(\" performLogin ✅ credential : \", credential);\n      return credential;\n    } catch (error) {\n      console.log(\"performLogin ❌  Failed to get credential with error : \", error);\n      return null;\n    }\n  };\n  const signIn = async () => {\n    console.log(\"⚈ ⚈ ⚈ signIn ⚈ ⚈ ⚈\");\n    // Get the account related to the username.\n    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n    // MARK: THIS SHOULD BE DONE ON THE BACKEND\n    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n    // const userAccount = getUserAccount();\n    const loginPasskeyId = localStorage.getItem(`${username}_passkeyId`);\n    const loginChallengeBuffer = localStorage.getItem(`${username}_challengeBuffer`);\n    const loginUserId = localStorage.getItem(`${username}_userId`);\n    const loginChallenge = localStorage.getItem(`${username}_challenge`);\n    console.log(\"⚈ ⚈ ⚈ getUserAccount ⚈ ⚈ ⚈\");\n    if (loginPasskeyId !== null && loginChallengeBuffer != null && loginUserId !== null && loginChallenge !== null) {\n      // console.log(\n      //   \"Get User Account ✅ There is a match for that username : \",\n      //   userAccount\n      // );\n      // Login with the details.\n      // This part remains on the front-end in production.\n      const credential = await performLogin(loginChallengeBuffer, username);\n      if (credential === null) {\n        // alert('Failed to get credential')\n        return Promise.reject(new Error(\"Failed to get credential\"));\n      }\n      if (credential !== null) {\n        console.log(\"credential: \", credential);\n        //@ts-ignore\n        const response = credential.response;\n        const signatureResponse = {\n          clientDataJSON: base64url.encode(response.clientDataJSON),\n          authenticatorData: base64url.encode(response.authenticatorData),\n          signature: base64url.encode(response.signature),\n          userHandle: base64url.encode(response.userHandle)\n        };\n        const ecVerifyInputs = authResponseToSigVerificationInput({}, signatureResponse);\n        console.log('verify inputs', ecVerifyInputs);\n        console.log(\"R: \", ecVerifyInputs.signature[0]);\n        console.log(\"S: \", ecVerifyInputs.signature[1]);\n\n        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n        // MARK: THIS SHOULD BE DONE ON THE BACKEND\n        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n        /*\n          This functionality confirms that theres a credentials are valid\n          and that they match the details related to the users account.\n        */\n        switch (verifyUserId(credential, loginUserId)) {\n          case true:\n            switch (verifyClientData(credential, loginChallenge)) {\n              case true:\n                console.log(\"✅ You have succesfully logged in.\");\n                onSignIn();\n                break;\n              case false:\n                console.log(\"❌ The challenge does not match.\");\n                break;\n            }\n            break;\n          case false:\n            break;\n        }\n      } else {\n        console.log(\" signIn ❌ Failed to perform Login as credential does not exist.\");\n      }\n    } else {\n      console.log(\" signIn ❌ There is no match for that username.\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(UserName, {\n      placeholder: \"Please enter your email\",\n      type: \"text\",\n      autoComplete: \"username webauthn\",\n      value: username,\n      onChange: onUserNameChanged\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SignInButton, {\n      onClick: signIn,\n      children: \" Sign In\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Copy, {\n      children: \"Not Created an Account ?\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SignInButton, {\n      onClick: onRegister,\n      children: \"Register\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 142,\n    columnNumber: 5\n  }, this);\n};\n_s(Landing, \"4tEiAg2yxe++nyS1ywEe1qKMeMs=\", false, function () {\n  return [useSelector];\n});\n_c = Landing;\nexport default Landing;\nvar _c;\n$RefreshReg$(_c, \"Landing\");","map":{"version":3,"names":["React","useState","Container","SignInButton","Copy","UserName","getPasskeyCredential","verifyUserId","verifyClientData","useSelector","base64url","authResponseToSigVerificationInput","jsxDEV","_jsxDEV","Landing","onRegister","onSignIn","_s","username","setUsername","userAccounts","state","accounts","onUserNameChanged","ev","target","value","getUserAccount","undefined","match","filter","item","toLowerCase","length","performLogin","challenge","console","log","credential","error","signIn","loginPasskeyId","localStorage","getItem","loginChallengeBuffer","loginUserId","loginChallenge","Promise","reject","Error","response","signatureResponse","clientDataJSON","encode","authenticatorData","signature","userHandle","ecVerifyInputs","children","placeholder","type","autoComplete","onChange","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","$RefreshReg$"],"sources":["/Users/peterchen/Dropbox/Hexlink/Projects/pwa-demo/src/layouts/landing.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { Container, SignInButton, Copy, UserName } from \"components/shared\";\nimport getPasskeyCredential from \"utils/passkey/authenticate/getPasskeyCredential\";\nimport parseClientData from \"utils/passkey/shared/parseClientData\";\nimport UserAccount from \"types/passkey/userAccount\";\nimport verifyUserId from \"utils/passkey/authenticate/verifyUserId\";\nimport verifyClientData from \"utils/passkey/authenticate/verifyClientData\";\nimport store, { RootState } from \"redux-functionality/index\";\nimport { useSelector } from \"react-redux\";\nimport * as base64url from \"../utils/passkey/shared/base64url-arraybuffer\";\nimport { authResponseToSigVerificationInput } from \"utils/passkey/shared/authResponseToSigVerificationInput\";\n\ninterface Props {\n  onRegister: () => void;\n  onSignIn: () => void;\n}\n\n// markup\nconst Landing = ({ onRegister, onSignIn }: Props) => {\n  const [username, setUsername] = useState<string>(\"\");\n  \n  const userAccounts: Array<UserAccount> = useSelector(\n    (state: RootState) => state.userAccounts.accounts\n  );\n\n  const onUserNameChanged = (ev: React.ChangeEvent<HTMLInputElement>) => {\n    setUsername(ev.target.value);\n  };\n\n  // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n  // MARK: THIS SHOULD BE DONE ON THE BACKEND\n  // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n  /*\n      This functionality gathers the user account requested,\n      this should be gathered via an API call to the backend.\n  */\n\n  const getUserAccount = () => {\n    if (userAccounts === undefined) {\n      return null;\n    }\n\n    const match = userAccounts.filter(\n      (item) => item.username.toLowerCase() === username.toLowerCase()\n    );\n\n    if (match.length > 0) {\n      return match[0];\n    } else {\n      return null;\n    }\n  };\n\n  const performLogin = async (challenge: string, username: string) => {\n    console.log(\"⚈ ⚈ ⚈ performLogin ⚈ ⚈ ⚈\");\n    try {\n      const credential = await getPasskeyCredential(challenge, username);\n      console.log(\" performLogin ✅ credential : \", credential);\n      return credential;\n    } catch (error) {\n      console.log(\n        \"performLogin ❌  Failed to get credential with error : \",\n        error\n      );\n      return null;\n    }\n  };\n\n  const signIn = async () => {\n    console.log(\"⚈ ⚈ ⚈ signIn ⚈ ⚈ ⚈\");\n    // Get the account related to the username.\n    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n    // MARK: THIS SHOULD BE DONE ON THE BACKEND\n    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n    // const userAccount = getUserAccount();\n    const loginPasskeyId = localStorage.getItem(`${username}_passkeyId`);\n    const loginChallengeBuffer = localStorage.getItem(`${username}_challengeBuffer`)\n    const loginUserId = localStorage.getItem(`${username}_userId`)\n    const loginChallenge = localStorage.getItem(`${username}_challenge`)\n    console.log(\"⚈ ⚈ ⚈ getUserAccount ⚈ ⚈ ⚈\");\n    if (loginPasskeyId !== null && loginChallengeBuffer != null && loginUserId !== null && loginChallenge !== null) {\n      // console.log(\n      //   \"Get User Account ✅ There is a match for that username : \",\n      //   userAccount\n      // );\n      // Login with the details.\n      // This part remains on the front-end in production.\n      const credential = await performLogin(loginChallengeBuffer, username);\n      if (credential === null) {\n        // alert('Failed to get credential')\n        return Promise.reject(new Error(\"Failed to get credential\"));\n      }\n      \n      if (credential !== null) {\n        console.log(\"credential: \", credential);\n        //@ts-ignore\n        const response = credential.response;\n        const signatureResponse = {\n          clientDataJSON: base64url.encode(response.clientDataJSON),\n          authenticatorData: base64url.encode(response.authenticatorData),\n          signature: base64url.encode(response.signature),\n          userHandle: base64url.encode(response.userHandle),\n        }\n        const ecVerifyInputs = authResponseToSigVerificationInput({}, signatureResponse);\n        console.log('verify inputs', ecVerifyInputs);\n        console.log(\"R: \", ecVerifyInputs.signature[0]);\n        console.log(\"S: \", ecVerifyInputs.signature[1]);\n\n        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n        // MARK: THIS SHOULD BE DONE ON THE BACKEND\n        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n        /*\n          This functionality confirms that theres a credentials are valid\n          and that they match the details related to the users account.\n        */\n        switch (verifyUserId(credential, loginUserId)) {\n          case true:\n            switch (verifyClientData(credential, loginChallenge)) {\n              case true:\n                console.log(\"✅ You have succesfully logged in.\");\n                onSignIn();\n                break;\n              case false:\n                console.log(\"❌ The challenge does not match.\");\n                break;\n            }\n            break;\n          case false:\n            break;\n        }\n      } else {\n        console.log(\n          \" signIn ❌ Failed to perform Login as credential does not exist.\"\n        );\n      }\n    } else {\n      console.log(\" signIn ❌ There is no match for that username.\");\n    }\n  };\n\n  return (\n    <Container>\n      <UserName\n        placeholder={\"Please enter your email\"}\n        type={\"text\"}\n        autoComplete={\"username webauthn\"}\n        value={username}\n        onChange={onUserNameChanged}\n      />\n      <SignInButton onClick={signIn}> Sign In</SignInButton>\n      <Copy>Not Created an Account ?</Copy>\n      <SignInButton onClick={onRegister}>Register</SignInButton>\n    </Container>\n  );\n};\n\nexport default Landing;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}